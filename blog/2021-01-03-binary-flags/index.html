<!doctype html><html lang=en><head><meta charset=utf-8><title>Quick Review of the Most Popular Ways to Implement Flags - Anton Ohorodnyk</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel=apple-touch-icon sizes=180x180 href="/favicon/apple-touch-icon.png?v=1"><link rel=icon type=image/png sizes=32x32 href="/favicon/favicon-32x32.png?v=1"><link rel=icon type=image/png sizes=16x16 href="/favicon/favicon-16x16.png?v=1"><link rel=manifest href="/favicon/site.webmanifest?v=1"><link rel=mask-icon href="/favicon/safari-pinned-tab.svg?v=1" color=#262626><link rel="shortcut icon" href="/favicon/favicon.ico?v=1"><meta name=msapplication-config content="/favicon/browserconfig.xml?v=1"><meta name=msapplication-TileColor content="#262626"><meta name=theme-color content="#262626"><meta name=generator content="Hugo 0.80.0"><meta property="og:site_name" content="Anton Ohorodnyk"><meta property="og:title" content="Quick Review of the Most Popular Ways to Implement Flags"><meta property="og:description" content="Quick introduction to different type of flags with pros and cons"><meta property="description" content="Quick introduction to different type of flags with pros and cons"><meta property="og:url" content="https://anton.ohorodnyk.name/blog/2021-01-03-binary-flags/"><meta property="og:type" content="article"><meta property="og:image" content="https://anton.ohorodnyk.name/img/logo.jpg"><link rel=stylesheet href=/css/bundle.min.68711a5652beafd4fc3ce1580ce091ade2647106b03cfbd89f20fdd1569e0c61.css><link rel=stylesheet href=/css/add-on.css></head><body><header id=site-header><nav id=site-nav><h1 class=nav-title><a href=/ class=nav>Blog</a></h1><menu id=site-nav-menu class="flyout-menu menu"><a href=/ class="nav link"><i class="fa fa-home"></i>Home</a>
<a href=/about/ class="nav link"><i class="far fa-id-card"></i>About</a>
<a href=/blog/ class="nav link"><i class="far fa-newspaper"></i>Blog</a>
<a href=# class="nav link search-toggle"><i class="fas fa-search">&nbsp;</i>Search</a></menu>
<a href=# class="nav search-toggle"><i class="fas fa-search fa-2x">&nbsp;</i></a>
<a href=#site-nav class="nav nav-toggle"><i class="fas fa-bars fa-2x"></i></a></nav><menu id=search class=menu><input id=search-input class="search-input menu"></input><div id=search-results class="search-results menu"></div></menu></header><div id=wrapper><section id=site-intro><a href=/><img src=https://anton.ohorodnyk.name/img/logo.jpg class=circle width=100 alt="Anton Ohorodnyk"></a><header><h1>Anton Ohorodnyk</h1></header><main><p>Software Engineer</p></main><footer><ul class=socnet-icons><li><a href=//github.com/aohorodnyk target=_blank rel=noopener title=GitHub class="fab fa-github"></a></li><li><a href=//www.linkedin.com/in/aohorodnyk target=_blank rel=noopener title=LinkedIn class="fab fa-linkedin"></a></li><li><a href=//facebook.com/aohorodnyk target=_blank rel=noopener title=Facebook class="fab fa-facebook"></a></li><li><a href=//instagram.com/aohorodnyk target=_blank rel=noopener title=Instagram class="fab fa-instagram"></a></li><li><a href=//twitter.com/aohorodnyk target=_blank rel=noopener title=Twitter class="fab fa-twitter"></a></li><li><a href=//telegram.me/aohorodnyk target=_blank rel=noopener title=telegram class="fab fa-telegram"></a></li><li><a href=mailto:anton@ohorodnyk.name target=_blank title=Email class="far fa-envelope"></a></li></ul></footer></section><main id=site-main><article class=post><header><div class=title><h2><a href=/blog/2021-01-03-binary-flags/>Quick Review of the Most Popular Ways to Implement Flags</a></h2><p>Quick introduction to different type of flags with pros and cons</p></div><div class=meta><time datetime="2021-01-03 00:00:00 +0000 UTC">January 3, 2021</time><p>Anton Ohorodnyk</p><p>5-Minute Read</p></div></header><div id=socnet-share></div><div class=content><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#options>Options</a><ul><li><a href=#separate-field>Separate field</a></li><li><a href=#store-in-array>Store In Array</a></li><li><a href=#store-in-bitmask>Store In Bitmask</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav><h1 id=introduction>Introduction</h1><p>There are many ways to store flags and use them for communication between <code>client &lt;-> backend service</code> or <code>service &lt;-> service</code>. In the article, we are going to review the most popular options and we will try to help to choose the correct way for the next project.</p><p>The most popular ways to work with flags are:</p><ol><li>Store in separate <a href=https://en.wikipedia.org/wiki/Column_(database)>column in DB</a> or separate <a href=https://en.wikipedia.org/wiki/Property_(programming)>property in a class/struct</a></li><li>Store as an <a href=https://en.wikipedia.org/wiki/Array_data_structure>array</a> or in a <a href=https://en.wikipedia.org/wiki/Set_(abstract_data_type)>set</a></li><li>Store as binary data in a variable</li></ol><h1 id=options>Options</h1><h2 id=separate-field>Separate field</h2><p>It means we would create a separate column in DB for each flag.</p><h3 id=db-example>DB Example</h3><p>In an example, <code>is_new</code> will be a flag.</p><table><thead><tr><th>id</th><th>username</th><th>is_new</th></tr></thead><tbody><tr><td>1</td><td>test1</td><td>true</td></tr><tr><td>2</td><td>test2</td><td>false</td></tr></tbody></table><h3 id=json-example>JSON Example</h3><p>In a code or a NoSQL database representation would be:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>[
	{
		<span style=color:#f92672>&#34;id&#34;</span>: <span style=color:#ae81ff>1</span>,
		<span style=color:#f92672>&#34;username&#34;</span>: <span style=color:#e6db74>&#34;test1&#34;</span>,
		<span style=color:#f92672>&#34;is_new&#34;</span>: <span style=color:#66d9ef>true</span>
	},
	{
		<span style=color:#f92672>&#34;id&#34;</span>: <span style=color:#ae81ff>2</span>,
		<span style=color:#f92672>&#34;username&#34;</span>: <span style=color:#e6db74>&#34;test2&#34;</span>,
		<span style=color:#f92672>&#34;is_new&#34;</span>: <span style=color:#66d9ef>false</span>
	}
]
</code></pre></div><h3 id=pros>Pros</h3><ul><li>Simple to read</li><li>Simple to understand</li><li>Self-documented</li><li>In a code it can represent as typed properties</li><li>Simple to convert between different representations, like <code>struct/class -> JSON -> protobuf -> MsgPack -> DB row -> struct/class</code></li><li>Simple to use in search and aggregation requests in DB (for example by <a href=https://en.wikipedia.org/wiki/SQL>SQL</a>)</li><li>Can be updated in DB in parallel, by <a href=https://en.wikipedia.org/wiki/Update_(SQL)>UPDATE query</a></li></ul><h3 id=cons>Cons</h3><ul><li>Takes up memory/storage space/traffic</li><li>Could be expensive in development or risky to remove in case of dynamically typed languages</li><li>Could be expensive in development to add or remove or update in case of microservice architecture</li><li>Could be expensive in development to remove from <a href=https://en.wikipedia.org/wiki/Column_(database)>DB as a column</a></li></ul><h3 id=use-cases>Use Cases</h3><p>In my opinion, before using this approach, we should answer &ldquo;yes&rdquo; for all listed options in the <em>checklist</em>:</p><ul><li>I agree to extend add and remove columns in your database (or add fields to the NoSQL database)?</li><li>I understand it could take up resources in DB will be used</li><li>I do not have memory and traffic sensitive clients or services</li></ul><h2 id=store-in-array>Store In Array</h2><p>In the current implementation, we will store all flags as <code>strings</code> in an array.</p><h3 id=db-example-1>DB Example</h3><p>In a DB, we are going to store values in a separate table as <a href=https://en.wikipedia.org/wiki/One-to-many_(data_model)>one to many relationships</a>.</p><p>Table <code>user</code>:</p><table><thead><tr><th>id</th><th>username</th></tr></thead><tbody><tr><td>1</td><td>test1</td></tr><tr><td>2</td><td>test2</td></tr></tbody></table><p>Table <code>user_flag</code></p><table><thead><tr><th>id</th><th>user_id</th><th>flag</th></tr></thead><tbody><tr><td>1</td><td>1</td><td>is_new</td></tr><tr><td>2</td><td>1</td><td>is_test</td></tr></tbody></table><p>Every <code>user_flag</code> row is linked to a row in <code>user</code> table by <code>user_id</code> field.
It can be optimized to not store the flag as a string, but in our current topic, it is not so important.</p><h3 id=json-example-1>JSON Example</h3><p>In a code or a NoSQL database representation would be:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>
[
	{
		<span style=color:#f92672>&#34;id&#34;</span>: <span style=color:#ae81ff>1</span>,
		<span style=color:#f92672>&#34;username&#34;</span>: <span style=color:#e6db74>&#34;test1&#34;</span>,
		<span style=color:#f92672>&#34;flags&#34;</span>: [
			<span style=color:#e6db74>&#34;is_new&#34;</span>,
			<span style=color:#e6db74>&#34;is_test&#34;</span>
		]
	},
	{
		<span style=color:#f92672>&#34;id&#34;</span>: <span style=color:#ae81ff>2</span>,
		<span style=color:#f92672>&#34;username&#34;</span>: <span style=color:#e6db74>&#34;test2&#34;</span>,
		<span style=color:#f92672>&#34;flags&#34;</span>: []
	}
]
</code></pre></div><h3 id=pros-1>Pros</h3><ul><li>Simple to read</li><li>Simple to understand</li><li>Self-documented</li><li>Could be dynamically extended in a code (does not need to update code to add new flag)</li><li>Simple to convert between different representations, like <code>struct/class -> JSON -> protobuf -> MsgPack -> DB row -> struct/class</code></li><li>Pretty simple to use in search and aggregation requests in DB (for example by <a href=https://en.wikipedia.org/wiki/SQL>SQL</a>)</li><li>Can be updated in DB in parallel, by <a href=https://en.wikipedia.org/wiki/Insert_(SQL)>INSERT query</a> and <a href=https://en.wikipedia.org/wiki/Delete_(SQL)>DELETE query</a></li></ul><h3 id=cons-1>Cons</h3><ul><li>Takes up memory/storage space/traffic</li><li>Need to write additional code for <code>set</code> and <code>unset</code> and <code>find</code> functions</li><li>Could affect different limitation in case of many flags</li><li>Could affect performance, especially on a client-side</li></ul><h3 id=user-cases>User Cases</h3><p>In my opinion, before using this approach, we should answer &ldquo;yes&rdquo; for all listed options in the <em>checklist</em>:</p><ul><li>I do not have performance and memory and traffic sensitive clients or services</li><li>I understand it could take up resources on all sides it would be used</li></ul><h2 id=store-in-bitmask>Store In Bitmask</h2><p><a href=https://en.wikipedia.org/wiki/Mask_(computing)>Bitmask</a> is a way when we use <a href=https://en.wikipedia.org/wiki/Bitwise_operation>bitwise operations</a> to get access to specific <em>flag</em>. Every flag stores in binary data in memory, for example it can be stored in: <code>byte</code>, <code>short</code>, <code>int</code>, <code>uint</code>, <code>long</code>, <code>[]byte</code>, <code>[]short</code>, <code>map[int]byte</code>, etc.</p><p>To see code in action, simply read <a href=https://github.com/aohorodnyk/binflags/blob/main/README.md>README.md from binflags library</a>.</p><h3 id=db-example-2>DB Example</h3><p>In DB we can store bitmask in various types, like: <code>TINYINT</code>, <code>SMALLINT</code>, <code>MEDIUMINT</code>, <code>INT</code>, <code>BIGINT</code>, <code>BLOB</code> types.</p><table><thead><tr><th>id</th><th>username</th><th>flags</th></tr></thead><tbody><tr><td>1</td><td>test1</td><td>1</td></tr><tr><td>2</td><td>test2</td><td>0</td></tr></tbody></table><p>In the current example, <code>flags</code> field has the type <code>INT</code> and the first bit is <code>is_new</code> flag.</p><h3 id=json-example-2>JSON Example</h3><p>In a code or a NoSQL database representation would be:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>
[
	{
		<span style=color:#f92672>&#34;id&#34;</span>: <span style=color:#ae81ff>1</span>,
		<span style=color:#f92672>&#34;username&#34;</span>: <span style=color:#e6db74>&#34;test1&#34;</span>,
		<span style=color:#f92672>&#34;flags&#34;</span>: <span style=color:#ae81ff>1</span>
	},
	{
		<span style=color:#f92672>&#34;id&#34;</span>: <span style=color:#ae81ff>2</span>,
		<span style=color:#f92672>&#34;username&#34;</span>: <span style=color:#e6db74>&#34;test2&#34;</span>,
		<span style=color:#f92672>&#34;flags&#34;</span>: <span style=color:#ae81ff>0</span>
	}
]
</code></pre></div><h3 id=pros-2>Pros</h3><ul><li>Simple to understand</li><li>The fastest implementation for all operations with flags</li><li>Do not take up additional memory and traffic resources (always only 1 bit per flag)</li><li>Can be used in a search by DB (but cannot be efficiently used indexes)</li></ul><h3 id=cons-2>Cons</h3><ul><li>In some cases flags cannot be updated in parallel</li><li>Cannot search flags by index</li><li>Have to be documented (name to bit mapping)</li><li>Should be explained for some people</li></ul><h3 id=use-cases-1>Use Cases</h3><p>In my opinion, before using this approach, we should answer &ldquo;yes&rdquo; for all listed options in the <em>checklist</em>:</p><ul><li>I want to save memory/traffic/processor resources</li><li>I understand all limitations</li></ul><h1 id=conclusion>Conclusion</h1><p>As we can see, as usual, we do not have <em>silver bullet</em> for all use cases and systems. But the provided list of implementations can help to find the best solution for a specific project.</p><p>If you want to use the most efficient option in <a href=https://golang.org>Go</a>, I would suggest checking <a href=https://github.com/aohorodnyk/binflags>Go implementation of binary flags for various types</a>.</p></div><footer><div class=stats><ul class=categories><li>None</li></ul><ul class=tags><li>None</li></ul></div></footer></article><div class=pagination></div></main><section id=site-sidebar><section id=recent-posts><header><h1>Recent Posts</h1></header><article class=mini-post><header><h2><a href=/blog/2021-01-03-binary-flags/>Quick Review of the Most Popular Ways to Implement Flags</a></h2><time class=published datetime="2021-01-03 00:00:00 +0000 UTC">January 3, 2021</time></header></article></section></section><footer id=site-footer><ul class=socnet-icons><li><a href=//github.com/aohorodnyk target=_blank rel=noopener title=GitHub class="fab fa-github"></a></li><li><a href=//www.linkedin.com/in/aohorodnyk target=_blank rel=noopener title=LinkedIn class="fab fa-linkedin"></a></li><li><a href=//facebook.com/aohorodnyk target=_blank rel=noopener title=Facebook class="fab fa-facebook"></a></li><li><a href=//instagram.com/aohorodnyk target=_blank rel=noopener title=Instagram class="fab fa-instagram"></a></li><li><a href=//twitter.com/aohorodnyk target=_blank rel=noopener title=Twitter class="fab fa-twitter"></a></li><li><a href=//telegram.me/aohorodnyk target=_blank rel=noopener title=telegram class="fab fa-telegram"></a></li><li><a href=mailto:anton@ohorodnyk.name target=_blank title=Email class="far fa-envelope"></a></li></ul><p class=copyright>Â© 2021 Anton Ohorodnyk<br>Theme: <a href=https://github.com/pacollins/hugo-future-imperfect-slim target=_blank rel=noopener>Hugo Future Imperfect Slim</a><br>A <a href=https://html5up.net/future-imperfect target=_blank rel=noopener>HTML5 UP port</a> | Powered by <a href=https://gohugo.io/ title=0.80.0 target=_blank rel=noopener>Hugo</a></p></footer><a id=back-to-top href=# class="fas fa-arrow-up fa-2x"></a><script src=/js/bundle.min.b4e669fa428a81defb8af0916c53f39cd1b8e0bbab22199c06f0b182907ba474.js></script><script src=/js/add-on.js></script></div></body></html>